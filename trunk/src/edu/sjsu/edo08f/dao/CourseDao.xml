<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap
        PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
        "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="Course">

    <typeAlias alias="Course" type="edu.sjsu.edo08f.domain.Course" />
    <typeAlias alias="EventInformation" type="edu.sjsu.edo08f.support.EventInformation" />

    <resultMap id="courseResultMap" class="Course">
        <result property="id" column="id" javaType="java.lang.Long"  />
        <result property="name" column="name" javaType="java.lang.String"  />
        <result property="section" column="section" javaType="java.lang.Integer"  />
        <result property="location" column="location" javaType="java.lang.String"  />
        <result property="meetingHours" column="id" select="Common.selectCourseHoursForCourse"  />
        <result property="units" column="units" javaType="java.lang.Integer"  />
    </resultMap>

    <sql id="selectCourse">
        select
        course.id as id,
        course.name as name,
        course.section as section,
        location.name as location,
        course.units as units
        from universitySystem.Course course
        left join universitySystem.Location location
        on location.id = course.location_id
    </sql>

    <select id="getById" parameterClass="java.lang.Long"
            resultMap="courseResultMap" resultClass="Course">
        <include refid="selectCourse"/>
        where course.id = #value#
    </select>

    <select id="getAll" resultMap="courseResultMap" resultClass="Course">
        <include refid="selectCourse"/>
    </select>

    <select id="getByNameAndSection" parameterClass="java.util.Map" resultClass="Course"
            resultMap="courseResultMap">
        <include refid="selectCourse"/>
        where course.name = #name#
        and course.section = #section#
    </select>

    <select id="getByLocationName" parameterClass="java.lang.String"
            resultMap="courseResultMap" resultClass="Course">
        <include refid="selectCourse"/>
        where location.name = #value#
    </select>

    <select id="getByInstructorId" parameterClass="java.lang.Long"
            resultMap="courseResultMap" resultClass="Course">
        <include refid="selectCourse"/>
        where course.instructor_id = #value#
    </select>

    <insert id="create" parameterClass="java.util.Map">
        insert into universitySystem.COURSE
            (name, section, location_id, instructor_id, units)
        VALUES
            (#course.name#, #course.section#, #locationId#, #instructorId#, #course.units#)
        <selectKey keyProperty="course.id" resultClass="java.lang.Long">
            SELECT LAST_INSERT_ID()
        </selectKey>
    </insert>

    <update id="update" parameterClass="java.util.Map">
        UPDATE universitySystem.COURSE
                SET
        name = #course.name#,
        section = #course.section#,
        units = #course.units#,
        location_id = #locationId#
    </update>

</sqlMap>